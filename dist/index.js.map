{"version":3,"file":"index.js","sources":["../src/validator.core.js","../src/validator.js"],"sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\n\nconsole.log(1234)\n\nexport default class ValidatorCore extends React.Component {\n\n  static propTypes = {\n    defaultValue: PropTypes.any\n  };\n\n  static defaultProps = {\n    enableEventListeners: true,\n    bool: false,\n    defaultValue: '',\n    wrapper: 'div',\n    validators: [],\n    customValidator(value) { return true },\n    onValidateForm() {},\n    onValidate() {},\n    render(props) {\n      return null\n    }\n  };\n\n  /* LIFECYCLE */\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      value: this.props.value === undefined ? this.props.defaultValue : this.props.value,\n      messages: [],\n      isValid: true,\n      hasError: false,\n    }\n\n    this.props.onValidateForm.validators = this.props.onValidateForm.validators || [];\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.value !== nextProps.value) {\n      this.setState({\n        value: nextProps.value\n      });\n    }\n  }\n\n  componentDidMount() {\n    this.props.onValidateForm.validators.push(this);\n    this.props.onValidateForm.panic = () => {\n      const results = this.props.onValidateForm.validators.map(instance => instance.panic());\n      return results.every(isTrue => isTrue);\n    };\n    this.props.onValidateForm.check = () => {\n      const results = this.props.onValidateForm.validators.map(instance => !instance.hasError);\n      return results.every(isTrue => isTrue);\n    };\n\n    if (this.props.enableEventListeners) {\n      const domNode = ReactDOM.findDOMNode(this);\n\n      domNode.addEventListener('change', (ev) => this._onChange(ev), {\n        capture: true,\n      });\n      domNode.addEventListener('focus', (ev) => this._onFocus(ev), {\n        capture: true,\n      });\n      domNode.addEventListener('blur', (ev) => this._onBlur(ev), {\n        capture: true,\n      });\n    }\n\n  }\n\n  componentWillUnmount() {\n    const index = this.props.onValidateForm.validators.indexOf(this);\n    this.props.onValidateForm.validators.splice(index, 1);\n  }\n\n  componentWillUpdate(nextProps, nextState) {\n    // const [ messages, promises ] = nextState.messages.reduce((result, item, index, array) => {\n    //   let [ messages, promises ] = result;\n      \n    //   if (item instanceof String) {\n    //     messages.push(item);\n    //   }\n\n    //   if (item instanceof Promise) {\n    //     promises.push(item);\n    //   }\n\n    //   return result;\n    // }, [[],[]]);\n\n    const state = {\n      isValid: true,\n      messages: nextState.messages,\n      hasError: false\n    };\n    let needUpdate = false;\n\n    if (!this.props.bool && !this.state[this._valueProp] && nextProps.value !== this.state[this._valueProp]) {\n      needUpdate = true;\n      state.messages = this._checkErrors(nextProps.value); \n      state.value = nextProps.value;\n\n      state.isValid = !state.messages.length;\n    }\n\n    if (nextState[this._valueProp] !== this.state[this._valueProp]) {\n      needUpdate = true;\n      state.messages = this._checkErrors(nextState[this._valueProp]); \n\n      if (nextState.hasFocus) {\n        // state.messages = [];\n        state.isValid = true;\n        state.hasError = false;\n      } else {\n        state.isValid = !state.messages.length;\n      }\n    }\n\n    if (nextState.hasFocus !== this.state.hasFocus) {\n      needUpdate = true;\n      state.messages = this._checkErrors(nextState[this._valueProp]);\n\n      if (nextState.hasFocus) {\n        // state.messages = [];\n        state.isValid = true;\n        state.hasError = false;\n      } else {\n        state.isValid = !state.messages.length;\n        state.hasError = !state.isValid;\n      }\n    }\n\n    if (needUpdate) {\n      this.setState(state, () => {\n        this.props.onValidate(state);\n      });\n    }\n  }\n\n  render() {\n    return this.props.render(this.state);\n    // const Wrapper = this.props.wrapper;\n    // return (\n    //   <Wrapper \n    //     ref={el => this.el = el} \n    //     onChange={(ev) => this._onChange(ev)} \n    //     onFocus={(ev) => this._onFocus(ev)} \n    //     onBlur={(ev) => this._onBlur(ev)}\n    //     className={this.props.className}>\n    //     {this.props.render(this.state)}\n    //   </Wrapper>\n    // )\n  }\n\n  /* PUBLIC */\n\n  panic() {\n    let state = {\n      isValid: true,\n      messages: this.state.messages,\n      hasError: false\n    };\n\n    state.messages = this._checkErrors(this.state[this._valueProp]); \n    state.isValid = !state.messages.length;\n    state.hasError = !state.isValid;\n\n    /*let rect = this.el.getBoundingClientRect();\n\n    \n    setTimeout(() => {\n      if (state.hasError && rect.y) {\n        window.scrollTo(0, rect.y - 80);\n      }\n    }, 50)*/\n\n    this.setState(state, () => {\n      this.props.onValidateForm(state);\n      this.props.onValidate(state);\n    });\n\n    return !state.hasError;\n  }\n\n  get hasError() {\n    return this._checkErrors(this.state[this._valueProp]).length; \n  }\n\n  get errors() {\n    return this.state.messages;\n  }\n\n  /* PRIVATE */\n\n  _onChange(ev) {\n    this.setState({ \n      isChanged: true, \n      value: this.props.hasOwnProperty('value') ? this.props.value : ev.target.value, \n      checked: this.props.hasOwnProperty('checked') ? this.props.checked : ev.target.checked \n    });\n  }\n\n  _onFocus(ev) {\n    this.setState({ \n      hasFocus: true \n    })\n  }\n\n  _onBlur(ev) {\n    this.setState({ \n      isChanged: true, \n      hasFocus: false \n    })\n  }\n\n  _checkErrors(value) {\n    const isRequired = this.props.validators.includes('isRequired')\n    let validators = [];\n    let names = [];\n    let params = [];\n    let errors = [];\n\n    this.props.validators.forEach(methodName => {\n      let validator;\n\n      if (typeof methodName === 'string' && this[methodName] && typeof this[methodName] === 'function') {\n        validators.push({\n          func: this[methodName],\n          name: methodName,\n          params: []\n        });\n      }\n\n      if (typeof methodName === 'function') {\n        validators.push({\n          func: methodName,\n          name: 'unknown',\n          params: []\n        });\n      }\n\n      if (typeof methodName === 'object') {\n        const hash = methodName;\n        const defaultFunc = typeof this[hash.name] === 'function' ? this[hash.name] : null\n        const func = hash.func || defaultFunc;\n        if (func) {\n          validators.push({\n            func: func,\n            name: hash.name || 'unknown',\n            params: [].concat(hash.params || [])\n          });\n        } else {\n          debugger\n        }\n      }\n    });\n\n    if (isRequired ? true : Boolean(value)) {\n      validators.forEach((validator, index) => {\n\n        const result = validator.func.apply(this, [value].concat(validator.params))\n\n        if (!result) {\n          const methodName = validator.name;\n          const message = this.props[methodName + 'Error'] || this[methodName + 'Error'] || 'Error';\n          errors.push(message);\n        }\n\n        if (result instanceof Promise) {\n          errors.push(result);\n        }\n      });\n    }\n\n    return errors;\n  }\n\n  get _valueProp() {\n    if (this.props.bool) {\n      return 'checked';\n    } else {\n      return 'value';\n    }\n  }\n\n}","import React from 'react';\nimport PropTypes from 'prop-types';\nimport ValidatorCore from './validator.core';\n\n\nexport default class Validator extends ValidatorCore {\n\n  isRequiredError = 'This field is required';\n  isTextError = 'Value is not a string';\n  isNumberError = 'Value is not a number';\n  isUrlPathError = 'Value is not a path';\n  isUrlError = 'Value is not a url';\n  isEmailError = 'Value is not a email';\n\n  isRequired(value) {\n    return Boolean(value);\n  }\n\n  isText(value) {\n    return typeof value === 'string'\n  }\n\n  isNumber(value) {\n    value = Number(value)\n    return typeof value === 'number' && !isNaN(value)\n  }\n\n  isUrl(value) {\n    value = String(value)\n    const reg = /^(http:\\/\\/www\\.|https:\\/\\/www\\.|http:\\/\\/|https:\\/\\/)?[a-z0-9]+([\\-\\.]{1}[a-z0-9]+)*\\.[a-z]{2,5}(:[0-9]{1,5})?(\\/.*)?$/gm;\n    return value.match(reg);\n  }\n\n  isUrlPath(value) {\n    value = String(value)\n    const reg = /^(\\/)([\\w\\-\\.]+[^#?\\s]+)([\\w\\-]*)?(#[\\w\\-]+)?$/g;\n    return value.match(reg)\n  }\n\n  isEmail(value) {\n    value = String(value)\n    const reg = /^[\\d\\w]+[\\w\\d._-]*@([\\w\\d-_]+\\.)+[\\w]{2,}$/i;\n    return value.match(reg);\n  }\n\n  isEq(value, compareValue) {\n    return String(value) === String(compareValue);\n  }\n\n  lengthGtEq(value, compareValue) {\n    value = String(value);\n    compareValue = Number(compareValue);\n    return value.length >= compareValue;\n  }\n\n}"],"names":["console","log","ValidatorCore","props","state","value","undefined","defaultValue","onValidateForm","validators","nextProps","setState","push","panic","results","map","instance","every","isTrue","check","hasError","enableEventListeners","domNode","ReactDOM","findDOMNode","addEventListener","ev","_onChange","_onFocus","_onBlur","index","indexOf","splice","nextState","messages","needUpdate","bool","_valueProp","_checkErrors","isValid","length","hasFocus","onValidate","render","hasOwnProperty","target","checked","isRequired","includes","errors","forEach","methodName","hash","defaultFunc","name","func","concat","params","Boolean","validator","result","apply","message","Promise","React","Component","propTypes","PropTypes","any","defaultProps","Validator","isRequiredError","isTextError","isNumberError","isUrlPathError","isUrlError","isEmailError","Number","isNaN","String","reg","match","compareValue"],"mappings":"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"}