{"version":3,"file":"index.es.js","sources":["../src/validator.core.js","../src/validator.js"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\n\nexport default class ValidatorCore extends React.Component {\n\n  static propTypes = {\n    defaultValue: PropTypes.any\n  };\n\n  static defaultProps = {\n    bool: false,\n    defaultValue: '',\n    wrapper: 'div',\n    validators: [],\n    customValidator(value) { return true },\n    onValidateForm() {},\n    onValidate() {},\n    render(props) {\n      return null\n    }\n  };\n\n  /* LIFECYCLE */\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      value: this.props.value || this.props.defaultValue,\n      messages: [],\n      isValid: true,\n      hasError: false,\n    }\n\n    this.props.onValidateForm.validators = this.props.onValidateForm.validators || [];\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.value !== nextProps.value) {\n      this.setState({\n        value: nextProps.value\n      });\n    }\n  }\n\n  componentDidMount() {\n    this.props.onValidateForm.validators.push(this);\n    this.props.onValidateForm.panic = () => {\n      const results = this.props.onValidateForm.validators.map(instance => instance.panic());\n      return results.every(isTrue => isTrue);\n    };\n    this.props.onValidateForm.check = () => {\n      const results = this.props.onValidateForm.validators.map(instance => !instance.hasError);\n      return results.every(isTrue => isTrue);\n    };\n  }\n\n  componentWillUnmount() {\n    const index = this.props.onValidateForm.validators.indexOf(this);\n    this.props.onValidateForm.validators.splice(index, 1);\n  }\n\n  componentWillUpdate(nextProps, nextState) {\n    // const [ messages, promises ] = nextState.messages.reduce((result, item, index, array) => {\n    //   let [ messages, promises ] = result;\n      \n    //   if (item instanceof String) {\n    //     messages.push(item);\n    //   }\n\n    //   if (item instanceof Promise) {\n    //     promises.push(item);\n    //   }\n\n    //   return result;\n    // }, [[],[]]);\n\n    const state = {\n      isValid: true,\n      messages: nextState.messages,\n      hasError: false\n    };\n    let needUpdate = false;\n\n    if (!this.props.bool && !this.state[this._valueProp] && nextProps.value !== this.state[this._valueProp]) {\n      needUpdate = true;\n      state.messages = this._checkErrors(nextProps.value); \n      state.value = nextProps.value;\n\n      state.isValid = !state.messages.length;\n    }\n\n    if (nextState[this._valueProp] !== this.state[this._valueProp]) {\n      needUpdate = true;\n      state.messages = this._checkErrors(nextState[this._valueProp]); \n\n      if (nextState.hasFocus) {\n        // state.messages = [];\n        state.isValid = true;\n        state.hasError = false;\n      } else {\n        state.isValid = !state.messages.length;\n      }\n    }\n\n    if (nextState.hasFocus !== this.state.hasFocus) {\n      needUpdate = true;\n      state.messages = this._checkErrors(nextState[this._valueProp]);\n\n      if (nextState.hasFocus) {\n        // state.messages = [];\n        state.isValid = true;\n        state.hasError = false;\n      } else {\n        state.isValid = !state.messages.length;\n        state.hasError = !state.isValid;\n      }\n    }\n\n    if (needUpdate) {\n      this.setState(state, () => {\n        this.props.onValidate(state);\n      });\n    }\n  }\n\n  render() {\n    const Wrapper = this.props.wrapper;\n    return (\n      <Wrapper \n        ref={el => this.el = el} \n        onChange={(ev) => this._onChange(ev)} \n        onFocus={(ev) => this._onFocus(ev)} \n        onBlur={(ev) => this._onBlur(ev)}\n        className={this.props.className}>\n        {this.props.render(this.state)}\n      </Wrapper>\n    )\n  }\n\n  /* PUBLIC */\n\n  panic() {\n    let state = {\n      isValid: true,\n      messages: this.state.messages,\n      hasError: false\n    };\n\n    state.messages = this._checkErrors(this.state[this._valueProp]); \n    state.isValid = !state.messages.length;\n    state.hasError = !state.isValid;\n\n    let rect = this.el.getBoundingClientRect();\n\n    \n    setTimeout(() => {\n      if (state.hasError && rect.y) {\n        window.scrollTo(0, rect.y - 80);\n      }\n    }, 50)\n\n    this.setState(state, () => {\n      this.props.onValidateForm(state);\n      this.props.onValidate(state);\n    });\n\n    return !state.hasError;\n  }\n\n  get hasError() {\n    return this._checkErrors(this.state[this._valueProp]).length; \n  }\n\n  get errors() {\n    return this.state.messages;\n  }\n\n  /* PRIVATE */\n\n  _onChange(ev) {\n    this.setState({ \n      isChanged: true, \n      value: this.props.hasOwnProperty('value') ? this.props.value : ev.target.value, \n      checked: this.props.hasOwnProperty('checked') ? this.props.checked : ev.target.checked \n    });\n  }\n\n  _onFocus(ev) {\n    this.setState({ \n      hasFocus: true \n    })\n  }\n\n  _onBlur(ev) {\n    this.setState({ \n      isChanged: true, \n      hasFocus: false \n    })\n  }\n\n  _checkErrors(value) {\n    const isRequired = this.props.validators.includes('isRequired')\n    let validators = [];\n    let names = [];\n    let params = [];\n    let errors = [];\n\n    this.props.validators.forEach(methodName => {\n      let validator;\n\n      if (typeof methodName === 'string' && this[methodName] && typeof this[methodName] === 'function') {\n        validators.push({\n          func: this[methodName],\n          name: methodName,\n          params: []\n        });\n      }\n\n      if (typeof methodName === 'function') {\n        validators.push({\n          func: methodName,\n          name: 'unknown',\n          params: []\n        });\n      }\n\n      if (typeof methodName === 'object') {\n        const hash = methodName;\n        const defaultFunc = typeof this[hash.name] === 'function' ? this[hash.name] : null\n        const func = hash.func || defaultFunc;\n        if (func) {\n          validators.push({\n            func: func,\n            name: hash.name || 'unknown',\n            params: [].concat(hash.params || [])\n          });\n        } else {\n          debugger\n        }\n      }\n    });\n\n    if (isRequired ? true : Boolean(value)) {\n      validators.forEach((validator, index) => {\n\n        const result = validator.func.apply(this, [value].concat(validator.params))\n\n        if (!result) {\n          const methodName = validator.name;\n          const message = this.props[methodName + 'Error'] || this[methodName + 'Error'] || 'Error';\n          errors.push(message);\n        }\n\n        if (result instanceof Promise) {\n          errors.push(result);\n        }\n      });\n    }\n\n    return errors;\n  }\n\n  get _valueProp() {\n    if (this.props.bool) {\n      return 'checked';\n    } else {\n      return 'value';\n    }\n  }\n\n}","import React from 'react';\nimport PropTypes from 'prop-types';\nimport ValidatorCore from './validator.core';\n\n\nexport default class Validator extends ValidatorCore {\n\n  isRequiredError = 'This field is required';\n  isTextError = 'Value is not a string';\n  isNumberError = 'Value is not a number';\n  isUrlPathError = 'Value is not a path';\n  isUrlError = 'Value is not a url';\n  isEmailError = 'Value is not a email';\n\n  isRequired(value) {\n    return Boolean(value);\n  }\n\n  isText(value) {\n    return typeof value === 'string'\n  }\n\n  isNumber(value) {\n    value = Number(value)\n    return typeof value === 'number' && !isNaN(value)\n  }\n\n  isUrl(value) {\n    value = String(value)\n    const reg = /^(http:\\/\\/www\\.|https:\\/\\/www\\.|http:\\/\\/|https:\\/\\/)?[a-z0-9]+([\\-\\.]{1}[a-z0-9]+)*\\.[a-z]{2,5}(:[0-9]{1,5})?(\\/.*)?$/gm;\n    return value.match(reg);\n  }\n\n  isUrlPath(value) {\n    value = String(value)\n    const reg = /^(\\/)([\\w\\-\\.]+[^#?\\s]+)([\\w\\-]*)?(#[\\w\\-]+)?$/g;\n    return value.match(reg)\n  }\n\n  isEmail(value) {\n    value = String(value)\n    const reg = /^[\\d\\w]+[\\w\\d._-]*@([\\w\\d-_]+\\.)+[\\w]{2,}$/i;\n    return value.match(reg);\n  }\n\n  isEq(value, compareValue) {\n    return String(value) === String(compareValue);\n  }\n\n  lengthGtEq(value, compareValue) {\n    value = String(value);\n    compareValue = Number(compareValue);\n    return value.length >= compareValue;\n  }\n\n}"],"names":["ValidatorCore","props","state","value","defaultValue","onValidateForm","validators","nextProps","setState","push","panic","results","map","instance","every","isTrue","check","hasError","index","indexOf","splice","nextState","messages","needUpdate","bool","_valueProp","_checkErrors","isValid","length","hasFocus","onValidate","Wrapper","wrapper","el","ev","_onChange","_onFocus","_onBlur","className","render","rect","getBoundingClientRect","y","scrollTo","hasOwnProperty","target","checked","isRequired","includes","errors","forEach","methodName","hash","defaultFunc","name","func","concat","params","Boolean","validator","result","apply","message","Promise","React","Component","propTypes","PropTypes","any","defaultProps","Validator","isRequiredError","isTextError","isNumberError","isUrlPathError","isUrlError","isEmailError","Number","isNaN","String","reg","match","compareValue"],"mappings":"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"}